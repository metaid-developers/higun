# UTXO Indexer å¤šé“¾æ”¯æŒæ”¹é€ æ–¹æ¡ˆæ€»ç»“

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

ä¸º UTXO Indexer æ·»åŠ å¤šé“¾æ”¯æŒ,é€šè¿‡é…ç½®æ–‡ä»¶çš„ `chain` å­—æ®µæ ‡è¯†é“¾ç±»å‹(BTC/MVC/DOGEç­‰),ç”¨äºé€‰æ‹©æ­£ç¡®çš„äº¤æ˜“å’Œåœ°å€è§£æå™¨ã€‚æ¯ä¸ªå®ä¾‹ç‹¬ç«‹è¿è¡Œä¸€æ¡é“¾,ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®ç›®å½•ã€‚æ·»åŠ æ–°é“¾æ—¶åªéœ€å®ç°è¯¥é“¾çš„è§£æé€»è¾‘,æ‰€æœ‰å…¶ä»–åŠŸèƒ½(ç´¢å¼•ã€æŸ¥è¯¢ã€APIç­‰)å®Œå…¨å¤ç”¨ã€‚

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **æœ€å°åŒ–ä¿®æ”¹** - å¤ç”¨ç°æœ‰ä»£ç ,åªæ·»åŠ å¿…è¦çš„é…ç½®å’ŒéªŒè¯é€»è¾‘
2. **é…ç½®é©±åŠ¨** - é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ `chain` å­—æ®µæ ‡è¯†é“¾ç±»å‹,ç”¨äºé€‰æ‹©è§£æå™¨
3. **å®ä¾‹ç‹¬ç«‹** - æ¯ä¸ªå®ä¾‹ç‹¬ç«‹è¿è¡Œä¸€æ¡é“¾,ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®ç›®å½•
4. **å‘åå…¼å®¹** - ç°æœ‰åŠŸèƒ½ä¸å—å½±å“,ç°æœ‰æ•°æ®æ— éœ€è¿ç§»
5. **æ˜“äºæ‰©å±•** - æ”¯æŒæ–°é“¾åªéœ€æ·»åŠ è¯¥é“¾çš„äº¤æ˜“/åœ°å€è§£æä»£ç 

## ğŸ“Š æ”¹åŠ¨èŒƒå›´

### å¿…é¡»ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | ä»£ç è¡Œæ•° | éš¾åº¦ |
|-----|---------|---------|------|
| `config/config.go` | æ·»åŠ  Chain å­—æ®µã€éªŒè¯å’Œæ•°æ®ç›®å½•éš”ç¦»é€»è¾‘ | +50 è¡Œ | â­â­ |
| `config.yaml` | æ·»åŠ  chain å­—æ®µ | +1 è¡Œ | â­ |

### æ— éœ€ä¿®æ”¹çš„æ–‡ä»¶

- âœ… `blockchain/client.go` - å·²æœ‰é“¾åŒºåˆ†é€»è¾‘ (`c.cfg.RPC.Chain`)
- âœ… `blockchain/util.go` - å·²æœ‰ MVC/BTC è½¬æ¢æ–¹æ³•
- âœ… `main.go` - æ— éœ€ä¿®æ”¹,é…ç½®ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ

## ğŸ”§ æ ¸å¿ƒæ”¹åŠ¨ç‚¹

### 1. é…ç½®ç»“æ„å¢å¼º

```go
// æ–°å¢å¸¸é‡
const (
    ChainBTC = "btc"
    ChainMVC = "mvc"
)

// Config ç»“æ„ä½“æ–°å¢å­—æ®µ
type Config struct {
    Chain string `yaml:"chain"` // æ–°å¢: ç”¨äºæ ‡è¯†é“¾ç±»å‹,é€‰æ‹©æ­£ç¡®çš„è§£æå™¨
    // ... å…¶ä»–ç°æœ‰å­—æ®µ
}

// æ–°å¢æ–¹æ³•
func (c *Config) ValidateChain() error { ... }        // éªŒè¯é“¾é…ç½®
func (c *Config) GetChainName() string { ... }        // è·å–é“¾åç§°
func (c *Config) GetChainDataDir() string {           // ç›´æ¥è¿”å›é…ç½®çš„æ•°æ®ç›®å½•
    return c.DataDir  // ä¸æ·»åŠ é“¾åç§°å­ç›®å½•
}
```

### 2. é…ç½®æ–‡ä»¶æ ¼å¼

```yaml
# æ–°å¢å­—æ®µ
chain: "btc"  # æˆ– "mvc"

# ç°æœ‰é…ç½®ä¿æŒä¸å˜
network: "regtest"
data_dir: "/home/momo/data/higun/test"

rpc:
  chain: "btc"  # å¿…é¡»ä¸é¡¶å±‚ chain ä¸€è‡´
  host: "127.0.0.1"
  port: "18443"
```

### 3. æ•°æ®ç›®å½•ç‹¬ç«‹é…ç½®

```
æ¯ä¸ªå®ä¾‹ç‹¬ç«‹è¿è¡Œ,ä½¿ç”¨å„è‡ªé…ç½®çš„æ•°æ®ç›®å½•:

BTC å®ä¾‹:
/data/higun/btc_instance/
â”œâ”€â”€ utxo/
â”œâ”€â”€ income/
â””â”€â”€ spend/

MVC å®ä¾‹(å¯ä»¥åœ¨ä¸åŒæœåŠ¡å™¨):
/data/higun/mvc_instance/
â”œâ”€â”€ utxo/
â”œâ”€â”€ income/
â””â”€â”€ spend/

DOGE å®ä¾‹:
/data/higun/doge_instance/
â”œâ”€â”€ utxo/
â”œâ”€â”€ income/
â””â”€â”€ spend/
```

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: ä»£ç ä¿®æ”¹ (30 åˆ†é’Ÿ)

1. å¤‡ä»½ç°æœ‰æ–‡ä»¶
2. ä¿®æ”¹ `config/config.go`
   - æ·»åŠ å¸¸é‡å®šä¹‰
   - æ·»åŠ  Chain å­—æ®µ
   - æ·»åŠ  3 ä¸ªæ–°æ–¹æ³•
   - ä¿®æ”¹ LoadConfig å‡½æ•°
3. ä¿®æ”¹ `config.yaml` æ·»åŠ  chain å­—æ®µ

### é˜¶æ®µ 2: ç¼–è¯‘æµ‹è¯• (15 åˆ†é’Ÿ)

```bash
go build -o utxo_indexer_test
./utxo_indexer_test --config config.yaml
```

### é˜¶æ®µ 3: åŠŸèƒ½éªŒè¯ (30 åˆ†é’Ÿ)

1. éªŒè¯ BTC é…ç½®
2. éªŒè¯ MVC é…ç½®
3. éªŒè¯æ•°æ®ç›®å½•éš”ç¦»
4. éªŒè¯å¤šå®ä¾‹è¿è¡Œ

### é˜¶æ®µ 4: æ–‡æ¡£å’Œéƒ¨ç½² (15 åˆ†é’Ÿ)

1. åˆ›å»ºé…ç½®æ¨¡æ¿
2. æ›´æ–°éƒ¨ç½²æ–‡æ¡£
3. å¤‡ä»½æ—§ç‰ˆæœ¬

**æ€»è®¡: çº¦ 1.5 å°æ—¶**

## âœ… éªŒè¯æ ‡å‡†

### é…ç½®éªŒè¯

- [x] chain å­—æ®µå¿…å¡«
- [x] chain åªèƒ½æ˜¯ btc æˆ– mvc
- [x] chain å¿…é¡»ä¸ rpc.chain ä¸€è‡´
- [x] é…ç½®ä¸ä¸€è‡´æ—¶æŠ¥é”™æ˜ç¡®

### åŠŸèƒ½éªŒè¯

- [x] BTC é“¾æ­£å¸¸åŒæ­¥åŒºå—
- [x] MVC é“¾æ­£å¸¸åŒæ­¥åŒºå—
- [x] æ•°æ®å­˜å‚¨åœ¨é“¾ç‰¹å®šç›®å½•
- [x] ä¸åŒé…ç½®å¯åŒæ—¶è¿è¡Œ
- [x] API ç«¯å£ä¸å†²çª

### æ•°æ®éªŒè¯

- [x] UTXO æ•°æ®éš”ç¦»
- [x] åœ°å€ç´¢å¼•æ•°æ®éš”ç¦»
- [x] äº¤æ˜“èŠ±è´¹æ•°æ®éš”ç¦»
- [x] å…ƒæ•°æ®éš”ç¦»

## ğŸ“š æ–‡æ¡£æ¸…å•

å·²åˆ›å»ºçš„æ–‡æ¡£:

1. âœ… `MULTI_CHAIN_REFACTOR_PLAN.md` - è¯¦ç»†è®¾è®¡æ–¹æ¡ˆ
2. âœ… `docs/chain_config_examples.md` - é…ç½®ç¤ºä¾‹å¤§å…¨
3. âœ… `docs/code_modification_checklist.md` - ä»£ç ä¿®æ”¹æ¸…å•
4. âœ… `docs/config_refactored.go.example` - é‡æ„ä»£ç ç¤ºä¾‹
5. âœ… `docs/QUICK_START.md` - å¿«é€Ÿå®æ–½æŒ‡å—
6. âœ… `README_MULTI_CHAIN.md` - æœ¬æ€»ç»“æ–‡æ¡£

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: å•ä¸ª BTC å®ä¾‹

```bash
# config_btc.yaml
chain: "btc"
network: "mainnet"
data_dir: "/data/higun/btc"
api_port: "3001"

# å¯åŠ¨
./utxo_indexer --config config_btc.yaml
```

### åœºæ™¯ 2: å•ä¸ª MVC å®ä¾‹

```bash
# config_mvc.yaml
chain: "mvc"
network: "mainnet"
data_dir: "/data/higun/mvc"
api_port: "3002"

# å¯åŠ¨
./utxo_indexer --config config_mvc.yaml
```

### åœºæ™¯ 3: åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹

```bash
# ç»ˆç«¯ 1: BTC ä¸»ç½‘
./utxo_indexer --config config_btc_mainnet.yaml

# ç»ˆç«¯ 2: BTC æµ‹è¯•ç½‘
./utxo_indexer --config config_btc_testnet.yaml

# ç»ˆç«¯ 3: MVC ä¸»ç½‘
./utxo_indexer --config config_mvc_mainnet.yaml
```

### åœºæ™¯ 4: ä½¿ç”¨ Docker Compose

```yaml
version: '3.8'
services:
  btc-indexer:
    image: utxo-indexer:latest
    volumes:
      - ./config_btc.yaml:/app/config.yaml
      - /data/higun/btc:/data/higun/btc
    ports:
      - "3001:3001"

  mvc-indexer:
    image: utxo-indexer:latest
    volumes:
      - ./config_mvc.yaml:/app/config.yaml
      - /data/higun/mvc:/data/higun/mvc
    ports:
      - "3002:3002"
```

## ğŸ” ä»£ç å®¡æŸ¥è¦ç‚¹

### Config.go ä¿®æ”¹

```go
// âœ… æ­£ç¡®: æ·»åŠ äº† Chain å­—æ®µ
type Config struct {
    Chain   string `yaml:"chain"`
    Network string `yaml:"network"`
    // ...
}

// âœ… æ­£ç¡®: éªŒè¯é“¾é…ç½®
func (c *Config) ValidateChain() error {
    if c.Chain != c.RPC.Chain {
        return fmt.Errorf("chain mismatch")
    }
    return nil
}

// âœ… æ­£ç¡®: æ•°æ®ç›®å½•éš”ç¦»
func (c *Config) GetChainDataDir() string {
    return fmt.Sprintf("%s/%s", c.DataDir, c.Chain)
}

// âœ… æ­£ç¡®: åœ¨ LoadConfig ä¸­è°ƒç”¨éªŒè¯
if err := cfg.ValidateChain(); err != nil {
    return nil, err
}
```

### Config.yaml ä¿®æ”¹

```yaml
# âœ… æ­£ç¡®: æ·»åŠ äº† chain å­—æ®µ
chain: "btc"
network: "regtest"

rpc:
  chain: "btc"  # âœ… ä¸é¡¶å±‚ chain ä¸€è‡´
```

## âš ï¸ é£é™©ä¸å¯¹ç­–

### é£é™© 1: ç°æœ‰æ•°æ®è¿ç§»

**é£é™©**: ç°æœ‰æ•°æ®åœ¨æ—§ç›®å½•,æ–°ä»£ç æœŸæœ›åœ¨é“¾ç‰¹å®šç›®å½•  
**å¯¹ç­–**: æä¾›æ•°æ®è¿ç§»è„šæœ¬

```bash
#!/bin/bash
OLD_DIR="/home/momo/data/higun/test"
NEW_DIR="/home/momo/data/higun/test/btc"

mkdir -p "$NEW_DIR"
mv "$OLD_DIR/utxo" "$NEW_DIR/"
mv "$OLD_DIR/income" "$NEW_DIR/"
mv "$OLD_DIR/spend" "$NEW_DIR/"
mv "$OLD_DIR/meta" "$NEW_DIR/"
```

### é£é™© 2: é…ç½®ä¸ä¸€è‡´

**é£é™©**: chain å’Œ rpc.chain ä¸ä¸€è‡´å¯¼è‡´é”™è¯¯  
**å¯¹ç­–**: åœ¨é…ç½®åŠ è½½æ—¶ä¸¥æ ¼éªŒè¯,å¯åŠ¨å‰æ£€æŸ¥

### é£é™© 3: ç«¯å£å†²çª

**é£é™©**: å¤šå®ä¾‹ä½¿ç”¨ç›¸åŒç«¯å£  
**å¯¹ç­–**: é…ç½®æ¨¡æ¿ä¸­æ˜ç¡®ä¸åŒç«¯å£,æä¾›ç«¯å£æ£€æŸ¥å·¥å…·

### é£é™© 4: RPC å…¼å®¹æ€§

**é£é™©**: ä¸åŒé“¾çš„ RPC æ¥å£å¯èƒ½æœ‰å·®å¼‚  
**å¯¹ç­–**: ç°æœ‰ä»£ç å·²ç»å¤„ç†äº† BTC/MVC å·®å¼‚,æ— éœ€é¢å¤–ä¿®æ”¹

## ğŸ“ˆ æ‰©å±•æ€§

### æ·»åŠ æ–°é“¾çš„æ­¥éª¤

ä»¥æ·»åŠ  LTC (Litecoin) ä¸ºä¾‹:

1. **ä¿®æ”¹å¸¸é‡** (config.go):
```go
const (
    ChainBTC = "btc"
    ChainMVC = "mvc"
    ChainLTC = "ltc"  // æ–°å¢
)
```

2. **æ›´æ–°éªŒè¯** (config.go):
```go
supportedChains := map[string]bool{
    ChainBTC: true,
    ChainMVC: true,
    ChainLTC: true,  // æ–°å¢
}
```

3. **æ·»åŠ é“¾ç‰¹å®šå¤„ç†** (blockchain/client.go):
```go
// å¦‚æœ LTC æœ‰ç‰¹æ®Šå¤„ç†,åœ¨è¿™é‡Œæ·»åŠ 
if chainName == "ltc" {
    // LTC ç‰¹å®šé€»è¾‘
}
```

4. **åˆ›å»ºé…ç½®æ¨¡æ¿** (config_ltc.yaml):
```yaml
chain: "ltc"
network: "mainnet"
# ...
```

5. **æµ‹è¯•éªŒè¯**

## ğŸ‰ é¢„æœŸæ”¶ç›Š

### åŠŸèƒ½æ”¶ç›Š

1. âœ… æ”¯æŒå¤šæ¡ UTXO é“¾
2. âœ… æ•°æ®å®Œå…¨éš”ç¦»
3. âœ… å¯åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹
4. âœ… é…ç½®ç®€å•ç›´è§‚
5. âœ… æ˜“äºæ·»åŠ æ–°é“¾

### æŠ€æœ¯æ”¶ç›Š

1. âœ… ä»£ç ç»“æ„æ›´æ¸…æ™°
2. âœ… é…ç½®ç®¡ç†æ›´è§„èŒƒ
3. âœ… æ‰©å±•æ€§æ›´å¥½
4. âœ… ç»´æŠ¤æˆæœ¬é™ä½

### ä¸šåŠ¡æ”¶ç›Š

1. âœ… æ”¯æŒæ›´å¤šä¸šåŠ¡åœºæ™¯
2. âœ… æé«˜ç³»ç»Ÿçµæ´»æ€§
3. âœ… é™ä½è¿ç»´å¤æ‚åº¦

## ğŸ“ æ”¯æŒä¸åé¦ˆ

### å¸¸è§é—®é¢˜

å‚è€ƒ `docs/QUICK_START.md` çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†

### æŠ€æœ¯æ”¯æŒ

- è¯¦ç»†è®¾è®¡: æŸ¥çœ‹ `MULTI_CHAIN_REFACTOR_PLAN.md`
- é…ç½®ç¤ºä¾‹: æŸ¥çœ‹ `docs/chain_config_examples.md`
- å¿«é€Ÿå¼€å§‹: æŸ¥çœ‹ `docs/QUICK_START.md`
- ä»£ç æ¸…å•: æŸ¥çœ‹ `docs/code_modification_checklist.md`

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **æ”¹åŠ¨æœ€å°**: åªä¿®æ”¹ 2 ä¸ªæ–‡ä»¶,çº¦ 50 è¡Œä»£ç 
2. **é…ç½®é©±åŠ¨**: é€šè¿‡ `chain` å­—æ®µæŒ‡å®šé“¾ç±»å‹
3. **æ•°æ®éš”ç¦»**: è‡ªåŠ¨æŒ‰é“¾åˆ›å»ºç‹¬ç«‹ç›®å½•
4. **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½
5. **æ˜“äºæ‰©å±•**: æ·»åŠ æ–°é“¾åªéœ€ä¿®æ”¹é…ç½®

### å®æ–½å»ºè®®

- â±ï¸ é¢„è®¡å·¥ä½œé‡: 1.5 - 2 å°æ—¶
- ğŸ¯ éš¾åº¦ç­‰çº§: â­â­ (ä¸­ä½)
- ğŸ“Š é£é™©ç­‰çº§: ä½
- âœ… æ¨èå®æ–½: æ˜¯

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. é˜…è¯» `docs/QUICK_START.md` å¿«é€Ÿå¼€å§‹
2. æŒ‰ç…§æ¸…å•ä¿®æ”¹ä»£ç 
3. ç¼–è¯‘å’Œæµ‹è¯•éªŒè¯
4. åˆ›å»ºé…ç½®æ¨¡æ¿
5. éƒ¨ç½²å’Œç›‘æ§

---

**æ–¹æ¡ˆåˆ¶å®šæ—¶é—´**: 2025-11-21  
**é¢„è®¡å®æ–½æ—¶é—´**: 1.5 - 2 å°æ—¶  
**é£é™©è¯„ä¼°**: ä½é£é™©  
**æ¨èæŒ‡æ•°**: â­â­â­â­â­
